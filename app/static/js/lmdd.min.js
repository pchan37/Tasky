var lmdd_mousedown=0,lmdd=function(){"use strict";var r={containerClass:"lmdd-container",draggableItemClass:"lmdd-draggable",handleClass:!1,dragstartTimeout:50,calcInterval:200,revert:!0,nativeScroll:!1,mirrorMinHeight:100,mirrorMaxWidth:500,matchObject:!1,positionDelay:!1,dataMode:!1},c=null,f=null,u=null,p=null,m=null,g=!1,t=!1,h="waitDragStart",v=null,e=null,w=null,y={lastX:window.pageXOffset,lastY:window.pageYOffset,get x(){return window.pageXOffset-y.lastX},get y(){return window.pageYOffset-y.lastY}},b={x:0,y:0},C={currentTarget:!1,originalContainer:!1,originalNextSibling:!1,originalIndex:!1,currentContainer:!1,currentIndex:!1,previousContainer:!1,currentCoordinates:!1,currentPosition:!1,previousPosition:!1,referenceContainer:!1},R=0,O=new MutationObserver(function(e){e.forEach(function(e){0<e.addedNodes.length&&(k(c),D(c))})}),x={executeTask:function(e){x[e].forEach(function(e){e()}),x[e]=[]},onDragEnd:[],onTransitionEnd:[]};function E(e,t,n,o){n?e.classList.add(t):e.classList.remove(t),o&&x[o].push(function(){n?e.classList.remove(t):e.classList.add(t)})}function L(e,t,n,o,i){e.addEventListener(t,n,o),x[i].push(function(){e.removeEventListener(t,n,o)})}var I={event:null,active:!0,sm:20,el:document.documentElement,scrollInvoked:{top:!1,left:!1,bottom:!1,right:!1},get willScroll(){return{top:this.event.clientY<=this.sm&&0<window.pageYOffset,left:this.event.clientX<=this.sm&&0<window.pageXOffset,bottom:this.event.clientY>=this.el.clientHeight-this.sm&&window.pageYOffset<this.el.scrollHeight-this.el.clientHeight,right:this.event.clientX>=this.el.clientWidth-this.sm&&window.pageXOffset<this.el.scrollWidth-this.el.clientWidth}},get speed(){return Math.max(0,this.sm+Math.max(0-this.event.clientY,0-this.event.clientX,this.event.clientY-this.el.clientHeight,this.event.clientX-this.el.clientWidth))},updateEvent:function(e){for(var t in this.event=e,this.willScroll)this.willScroll[t]&&!this.scrollInvoked[t]&&this.move(t)},move:function(e){var t=this;this.scrollInvoked[e]=window.setInterval(function(){switch(e){case"top":window.scrollTo(window.pageXOffset,window.pageYOffset-t.speed);break;case"left":window.scrollTo(window.pageXOffset-t.speed,window.pageYOffset);break;case"bottom":window.scrollTo(window.pageXOffset,window.pageYOffset+t.speed);break;case"right":window.scrollTo(window.pageXOffset+t.speed,window.pageYOffset)}t.willScroll[e]&&t.active||(clearInterval(t.scrollInvoked[e]),t.scrollInvoked[e]=!1)},16)}};function S(e,t){for(var n=[],o=!1;e&&e!==document;e=e.parentNode)n.unshift(e),e.classList.contains(t)&&!o&&(o=e);return-1<n.indexOf(c)&&o}function a(e){if(!(1<e.touches.length)){var t="touchstart"===e.type?"mousedown":"touchend"===e.type?"mouseup":"mousemove",n=new MouseEvent(t,{view:window,bubbles:!0,cancelable:!0,screenX:e.touches[0]?e.touches[0].screenX:0,screenY:e.touches[0]?e.touches[0].screenY:0,clientX:e.touches[0]?e.touches[0].clientX:0,clientY:e.touches[0]?e.touches[0].clientY:0,button:0,buttons:1}),o="touchmove"===e.type?document.elementFromPoint(n.clientX,n.clientY)||document.body:e.target;"dragStart"===h&&e.preventDefault(),o.dispatchEvent(n)}}function N(e){return new CustomEvent(e,{bubbles:!0,detail:{dragType:g?"clone":"move",draggedElement:g?m.elref:f,from:{container:C.originalContainer,index:C.originalIndex},to:!!t&&{container:C.currentContainer,index:C.currentIndex}}})}function d(e){return e.preventDefault(),e.stopPropagation(),!1}function n(e){var o=[];return Array.prototype.forEach.call(e.childNodes,function(e,t){if(1===e.nodeType){var n=e.getBoundingClientRect();n.index=t,e.classList.contains(c.lmddOptions.draggableItemClass)&&o.push(n)}}),o}function T(e){C.originalContainer=e.parentNode,C.originalNextSibling=e.nextSibling,C.originalIndex=Array.prototype.indexOf.call(e.parentNode.childNodes,e)}function X(){C.previousContainer=C.currentContainer,C.currentTarget!==v.target&&(C.currentTarget=v.target,C.currentContainer=S(v.target,c.lmddOptions.containerClass))}function Y(){C.currentContainer?C.currentCoordinates=n(C.currentContainer):C.currentCoordinates=n(C.originalContainer)}function o(){C.previousPosition=C.currentPosition,C.currentContainer?C.currentPosition=function(e,t,n){var o=e.length;if(0===o)return null;for(var i=0,r=0,a=-1;i<=o;i++){if(i===o){i--;break}if(e[i].bottom>t){i--;break}}for(;r<=o&&r!==o&&!(e[r].top>t);r++);for(var d=i+1;d<=r;d++){if(d===r){a=d;break}if(e[d].left>n){a=d;break}}return a===o?e[a-1].index+1:e[a].index}(C.currentCoordinates,v.clientY,v.clientX):C.currentPosition=!1}function i(){C.currentContainer&&function(e,t){if(t.contains(e))return!1;if(e.classList.contains("lmdd-dispatcher"))return!1;if(c.lmddOptions.matchObject){var n=e.dataset.containerType||!1,o=t.dataset.itemType||!1;return n?o?c.lmddOptions.matchObject[n][o]:c.lmddOptions.matchObject[n].default:c.lmddOptions.matchObject.default}return!0}(C.currentContainer,f)?(C.currentContainer.insertBefore(f,C.currentContainer.childNodes[C.currentPosition]),C.currentIndex=Array.prototype.indexOf.call(f.parentNode.childNodes,f),g&&!t&&(m.elref.classList.remove("no-display"),m.elref.cloneRef.classList.remove("no-display"),m.elref.cloneRef.classList.add("no-transition"),T(f)),t=!0):c.lmddOptions.revert&&(C.originalContainer.insertBefore(f,C.originalNextSibling),C.currentIndex=C.originalIndex),Y(),e=v}function k(e){e.cloneRef.rectRef=e.getBoundingClientRect();var t=window.getComputedStyle?getComputedStyle(e,null):e.currentStyle;e.cloneRef.styleRef={top:{padding:parseInt(t.paddingTop,10),margin:parseInt(t.marginTop,10),border:parseInt(t.borderTopWidth,10)},left:{padding:parseInt(t.paddingLeft,10),margin:parseInt(t.marginLeft,10),border:parseInt(t.borderLeftWidth,10)}},e.classList.contains("lmdd-block")||Array.prototype.forEach.call(e.childNodes,function(e){1===e.nodeType&&k(e)})}function D(e){!function(e){var t=e.cloneRef,n=e.parentNode.cloneRef;if(t.style.position="absolute",t.style.webkitBackfaceVisibility="hidden",t.style.width=t.rectRef.width+"px",t.style.height=t.rectRef.height+"px",t.style.display="block",e===c)t.style.top=t.rectRef.top+window.pageYOffset+"px",t.style.left=t.rectRef.left+window.pageXOffset+"px";else{var o=g?C.referenceContainer.cloneRef:C.originalContainer.cloneRef,i=t.rectRef.left-(t===u?o.rectRef.left:n.rectRef.left),r=t.rectRef.top-(t===u?o.rectRef.top:n.rectRef.top),a=t===u?o.styleRef.left.border+o.styleRef.left.padding+u.offsetFix.left:n.styleRef.left.border+n.styleRef.left.padding+t.styleRef.left.margin,d=t===u?o.styleRef.top.border+o.styleRef.top.padding+u.offsetFix.top:n.styleRef.top.border+n.styleRef.top.padding+t.styleRef.top.margin;t.style.transform="translate3d("+(i-a)+"px, "+(r-d)+"px,0px)"}}(e),e.classList.contains("lmdd-block")||Array.prototype.forEach.call(e.childNodes,function(e){1===e.nodeType&&D(e)})}function M(){p.style.top=v.pageY-parseInt(p.parentNode.style.top,10)+y.y-b.y+"px",p.style.left=v.pageX-parseInt(p.parentNode.style.left,10)+y.x-b.x+"px"}function B(t){switch(h){case"waitDragStart":"mousedown"===t.type&&0===t.button&&(c=this,v=t,L(window,"mouseup",B,!1,"onDragEnd"),L(document,"mousemove",B,!1,"onDragEnd"),L(document,"scroll",B,!1,"onDragEnd"),h="dragStartTimeout",window.setTimeout(function(){if(0!=lmdd_mousedown&&"dragStartTimeout"===h)if(c.lmddOptions.handleClass&&!t.target.classList.contains(c.lmddOptions.handleClass))A();else{var e=S(t.target,c.lmddOptions.draggableItemClass);e?(c.dispatchEvent(new CustomEvent("lmddbeforestart",{bubbles:!0})),b.x=t.clientX-e.getBoundingClientRect().left,b.y=t.clientY-e.getBoundingClientRect().top,function(e){e.classList.contains("lmdd-clonner")&&(g=!0,(m=e.parentNode.insertBefore(e.cloneNode(!0),e)).classList.remove("lmdd-clonner"),e.classList.add("no-display"),m.elref=e);if(function(e){var t=e.cloneNode(!0);t.id+="-lmddClone";var n=[],o=[],i=function(e,t){t.push(e),Array.prototype.forEach.call(e.childNodes,function(e){i(e,t)})};i(e,n),i(t,o);for(var r=0;r<n.length;r++)n[r].cloneRef=o[r]}(c),u=(f=g?m:e).cloneRef,"LI"===(p=u.cloneNode(!0)).tagName){var t=document.createElement("ul");t.appendChild(p),t.style.padding=0,p.style.margin=0,(p=t).wrapped=!0}E(f,"lmdd-hidden",!0,"onDragEnd"),u.classList.add("lmdd-shadow"),T(f),C.referenceContainer=C.originalContainer,X(),Y(),window.getSelection().removeAllRanges(),E(document.body,"unselectable",!0,"onDragEnd"),c.parentNode.appendChild(c.cloneRef),x.onDragEnd.push(function(){c.parentNode.removeChild(c.cloneRef),function t(e){delete e.cloneRef,Array.prototype.forEach.call(e.childNodes,function(e){t(e)})}(c)});var n=u;for(;c.cloneRef.contains(n);)n.style.zIndex=0,n=n.parentNode;var o=window.getComputedStyle?getComputedStyle(u,null):u.currentStyle;u.offsetFix={left:parseInt(o.marginLeft,10),top:parseInt(o.marginTop,10),parent:f.parentNode.cloneRef},k(c),D(c),p.classList.add("lmdd-mirror"),["width","height","padding","paddingTop","paddingBottom","paddingLeft","paddingRight","lineHeight"].forEach(function(e){p.wrapped?p.childNodes[0].style[e]=o[e]:p.style[e]=o[e]});var i=c.lmddOptions.mirrorMaxWidth/u.getBoundingClientRect().width,r=c.lmddOptions.mirrorMinHeight/u.getBoundingClientRect().height,a=Math.min(1,Math.max(i,r));b.x*=a,b.y*=a,p.style.transform="scale("+a+","+a+")",p.style.transformOrigin="0 0",c.cloneRef.appendChild(p),p.addEventListener("transitionend",B,!1),y.lastX=window.pageXOffset,y.lastY=window.pageYOffset,M(),E(c,"hidden-layer",!0,"onDragEnd"),E(c.cloneRef,"visible-layer",!0,!1)}(e),document.body.setCapture&&(document.body.setCapture(!1),x.onDragEnd.push(function(){document.releaseCapture()})),clearInterval(w),w=window.setInterval(P,c.lmddOptions.calcInterval),O.observe(c,{childList:!0,subtree:!0}),c.lmddOptions.nativeScroll||t.preventDefault(),c.dispatchEvent(N("lmddstart")),h="dragStart",I.active=!0):A()}},c.lmddOptions.dragstartTimeout));break;case"dragStartTimeout":if(0===R)return void R++;A();break;case"dragStart":if("mousedown"===t.type||"mouseup"===t.type||"mousemove"===t.type&&0===t.buttons){if(!f)return void A();I.active=!1,p.classList.add("gf-transition");var e=p.getBoundingClientRect(),n=e.left-u.rectRef.left,o=e.top-u.rectRef.top,i=(r=c,a=f.cloneRef.rectRef,d=r.cloneRef.rectRef,l=r.cloneRef.styleRef.left.border,s=r.cloneRef.styleRef.top.border,{x:a.left-d.left-l,y:a.top-d.top-s});if(p.style.width=u.rectRef.width+"px",p.style.height=u.rectRef.height+"px",p.style.transform="scale(1,1)",p.style.top=i.y+"px",p.style.left=i.x+"px",!(3<Math.abs(n)+Math.abs(o)))return void A();h="waitDragEnd",x.onTransitionEnd.push(function(){A()})}"mousemove"===t.type&&(v=t,c.lmddOptions.nativeScroll||t.preventDefault(),y.lastX=window.pageXOffset,y.lastY=window.pageYOffset,M()),"scroll"===t.type&&(M(),Y());break;case"waitDragEnd":"transitionend"===t.type&&x.executeTask("onTransitionEnd"),"mouseup"===t.type&&A()}var r,a,d,l,s}function P(){return c.lmddOptions.nativeScroll||I.updateEvent(v),e!==v&&(!(e&&c.lmddOptions.positionDelay&&v.timeStamp-e.timeStamp<c.lmddOptions.calcInterval)&&("dragStart"===h&&(X(),void(C.currentContainer?C.currentContainer!==C.previousContainer?(Y(),o(),i()):(o(),C.currentPosition!==C.previousPosition&&i()):C.previousContainer&&c.lmddOptions.revert&&i()))))}function A(){O.disconnect(),clearInterval(w),w=null,R=0,I.active=!1,g&&!t&&(m.elref.classList.remove("no-display"),m.parentNode.removeChild(m)),g&&T(m.elref),x.executeTask("onDragEnd"),"dragStartTimeout"!==h&&"waitDragStart"!==h&&c.dispatchEvent(N("lmddend")),c.lmddOptions.dataMode&&(t&&g?f.parentNode.removeChild(f):t&&C.originalContainer.insertBefore(f,C.originalNextSibling)),g=t=!1,h="waitDragStart"}return{set:function(e,t){var n,o,i;e.lmdd||(!function e(t){for(var n=0;n<t.childNodes.length;n++){var o=t.childNodes[n];8===o.nodeType||3===o.nodeType&&!/\S/.test(o.nodeValue)?(t.removeChild(o),n--):1===o.nodeType&&e(o)}}(e),e.lmdd=!0,e.lmddOptions=(n=r,o=t,i={},Object.keys(n).forEach(function(e){i[e]=Object.prototype.hasOwnProperty.call(o,e)?o[e]:n[e]}),i),e.addEventListener("mousedown",B,!1),document.addEventListener("drag",d,!1),document.addEventListener("dragstart",d,!1),window.addEventListener("mousedown",function(){lmdd_mousedown++}),window.addEventListener("mouseup",function(){lmdd_mousedown--}),window.addEventListener("touchstart",a),window.addEventListener("touchmove",a,{passive:!1}),window.addEventListener("touchend",a))},unset:function(e){e.lmdd&&(e.removeEventListener("mousedown",B,!1),e.lmdd=!1,delete e.lmddOptions)},kill:function(){document.removeEventListener("drag",d,!1),document.removeEventListener("dragstart",d,!1),window.removeEventListener("touchstart",a),window.removeEventListener("touchmove",a,{passive:!1}),window.removeEventListener("touchend",a)}}}();